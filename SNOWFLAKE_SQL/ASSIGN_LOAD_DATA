
USE DATABASE DEMO_DATABASE;
USE SCHEMA PUBLIC;

------1.LOAD TABLE AND CREATE PRIMARY KEY 

CREATE OR REPLACE TABLE KJ_SALES_DATA
(
ORDER_ID VARCHAR(50) PRIMARY KEY,
ORDER_DATE  STRING,
SHIP_DATE STRING,
SHIP_MODE CHAR(15),
CUSTOMER_NAME VARCHAR(15),
SEGMENT CHAR(12),
STATE VARCHAR(150),
COUNTRY VARCHAR(35),
MARKET CHAR(7),
REGION CHAR(20),
PRODUCT_ID CHAR(15),
CATEGORY CHAR(16),
SUB_CATEGORY CHAR(15),
PRODUCT_NAME STRING,
SALES NUMBER(6,0),
QUANTITY INT,
DISCOUNT FLOAT,
PROFIT FLOAT,
SHIPPING_COST FLOAT,
ORDER_PRIORITY CHAR(10),
YEAR CHAR(5));

DESCRIBE TABLE KJ_SALES_DATA;

----CREATE  A COPY OF TABLE 

CREATE OR REPLACE TABLE KJ_SALES_DATA_COPY AS
SELECT*FROM KJ_SALES_DATA;

SELECT*FROM KJ_SALES_DATA_COPY;

--------2. CHECK THE ORDER DATE AND SHIP DATE TYPE AND THINK IN WHICH DATA TYPE ..
CREATE OR REPLACE TABLE KJ_SALES_DATA_COPY AS
SELECT *,
TO_CHAR(DATE(ORDER_DATE,'DD-MM-YYYY'),'YYYY-MM-DD')AS ORDER_DATE2
FROM KJ_SALES_DATA_COPY;

CREATE OR REPLACE TABLE KJ_SALES_DATA_COPY AS 
SELECT*, 
TO_CHAR(DATE(SHIP_DATE,'MM-DD-YYYY'),'YYYY-MM-DD') AS SHIP_DATE2
FROM KJ_SALES_DATA_COPY;

----3. Create a new column called order_extract and extract the number after the last FROM ORDER_ID COLUMN
CREATE OR REPLACE TABLE KJ_SALES_DATA_COPY AS
SELECT *, REGEXP_SUBSTR(ORDER_ID,'[[:DIGIT:]]+',1,2)AS ORDER_NUM
FROM KJ_SALES_DATA_COPY;

-----4.Create a new column called Discount Flag and categorize it based on discount UsE‘Yes’ if the discount is greater than zero else ‘No’
CREATE OR REPLACE TABLE KJ_SALES_DATA_COPY AS 
SELECT *, 
      CASE
      WHEN DISCOUNT>0 THEN 'YES'
      ELSE 'FALSE'
      END AS DISCOUNT_FLAG
FROM KJ_SALES_DATA_COPY;


-----5. FIND OUT THE FINAL PROFIT ADN PUT IN COLN FOR EVRY ORDER ID
SELECT
SUM(PROFIT)FROM KJ_SLAES_DATA_COPY AS OVERALL _PROFIT;

----6.Create a new column called process days and calculate how many days it takes for each order id to process from the order to its shipment.
CREATE OR REPLACE TABLE KJ_SALES_DATA_COPY AS
SELECT *,
DATEDIFF('DAYS',ORDER_DATE2,SHIP_DATE2) AS DAYS_TAKEN_TO_PROCESS_SHIPMENT
FROM KJ_SALES_DATA_COPY;

---7.Create a new column called Rating and then based on the Process dates give 
CREATE OR REPLACE TABLE KJ_SALES_DATA_COPY AS
SELECT *,
     CASE
     WHEN DAYS_TAKEN_TO_PROCESS_TO_SHIP <=3 THEN 5
     WHEN DAYS_TAKEN_TO_PROCESS BETWEEN 4 AND 6 THEN 4
     WHEN DAYS_TAKEN_TO_PROCESS BETWEEN 7 AND 10 THEN 3
     ELSE 2
END AS RATING FROM KJ_SALES_DATA_COPY;
